
[toc]

### Shiro介绍
shiro 安全框架包括：Authenticaton、Authorization、Sessoion Management、Cryptography，被称为应用安全的四大基石
![](https://note.youdao.com/yws/api/personal/file/WEB57b7437e5cef3c028f2e56c0e55fc82b?method=download&shareKey=58d07d6ad2479dcd76ffd05ed686be7e)
#### Authentication
- 用户的识别，通常被认为是用户的登录。

#### Authorization
- 访问控制，权限控制

#### SessionManagement
- 会话管理，用户会话管理

#### Cryptography
- 加密，对数据源使用加密算法的同时，保证它容易使用
- 还有其他功能来支持和加强这些不同环境应用下安全领域的关注点

除此之外，还有以下功能特色

#### WebSupport
- shiro 提供的web支持api可以轻松的保证web应用程序的安全

#### caching
- 缓存是shiro保证安全快速操作的重要操作手段

#### Concurrency
- 并发shiro支持多线程应用程序并发特性

#### Testing
- 测试，支持单元测试和集成测试

#### Runas
- 该功能在许可的前提下，允许用户假设另一个用户的身份

#### Remmeber Me
- 可以跨Session记录用户的身份，只有在强制需要时才需要登录


> Shiro不会去维护用户和权限，需要我们自己去提供及实现，然后通过相关接口注入给Shiro
---
### Shiro 三大组件
![](https://note.youdao.com/yws/api/personal/file/WEB5ca8ff0ed59841032cb29add39bdfa14?method=download&shareKey=e3d39f995a5d856533b83a9daad2beb7)
#### Subject
- 代表当前用户，可以是人、机器人、爬虫等。
- 所有Subject都绑定到SecurityManager，有SecurityManager来执行验证、授权等操作
- Subject是一个门面，SecurityManager才是真正的执行者

#### SecurityManager
- 安全管理器，所有与安全相关的操作都会与SecurityManager交互，其管理所有的Subject，是shiro的核心，负责与后面的组件交互

#### Realm
- 域，SecurityManager从域中获取安全数据，包括用户、角色、权限等。
- SecurityManager要验证用户身份，需要从reaml中获取相应用户的用户来进行比较，以确定用户的身份是否合法，也需要从Reaml中得到相应的角色以及权限进行验证用户是否可以进行操作。可以把Reaml看作安全的数据源。

### Shiro架构
![](https://note.youdao.com/yws/api/personal/file/WEB30939fa22fbb51465df39759745f3729?method=download&shareKey=9286c1e9b3404444d87bedc006f9b6a6)
#### Authenticator
- 用户管理器，该组件主要用于处理用户的登录逻辑，它通过调用Reaml接口来判断当前登录用户的身份。
- 如果系统中有多个Reaml，则需要设定用户认证策略，协调各个Reaml，以便这些用户的认证是成功还是失败

#### Authorizer
- 权限管理器，该组件主要用户用户的访问控制
- 跟Authenticator类似，Authorizer也应该知道怎么协调多个Reaml。

#### SessionManager
- 会话管理器，该组件拥有创建会话、管理会话的生命周期，一遍在所有运行环境下都可以给用户提供一个健全的会话管理体验
- shiro可以在本地管理用户会话，即便没有web容器或EJB容器也可以
- 如果环境下有会话管理机制，则shiro会默认使用当前环境的会话管理机制
- 当环境中没有会话管理机制时，shiro使用内部的会话管理器来给应用开发提供一致的编程体验。

#### SessionDao
- 允许用户使用任何程序的数据源来存储session数据，它主要是用来代替SessionManager执行Session相关的增删改查。
- 这个接口允许我们将任意种类的数据存储方式引入到Session管理的基础框架中

#### CacheManager
- 缓存管理器，该组件为用户创建和伟华一些在其他shiro组件中用的cache实例，维护这些Cache的生命周期
- 缓存用于存储从后端获取的用户验证及权限方面数据来提高性能
- 在获取数据时，先是从缓存中查找，如果没有在调用Reaml，通常来说数据源会配置一个。

#### Cryptographic
- 加密组件，包含一些易于使用的加密hash辅助类
- Reaml是连接shiro和安全数据的桥梁，任何时候当shiro需要进行登录或者访问控制的手，都需要调用已经配置好的reaml接口去获取数据。
- 一个应用程序可以配置一个或者多个reaml，通常来说一个数据源会配置一个。

### 角色模式
shiro支持两种角色模式
- 传统角色， 一个角色代表一些列的操作，当需要对某个操作进行授权验证时，只需要判断该角色即可。这种角色权限相对简单、模糊、不利于拓展。
- 权限角色，一个角色拥有一个权限的集合，授权验证时判断当前用户是否有该权限，这种角色权限可以对该角色进行详细的权限描述，适合更复杂的权限设计。
